!function(e){function t(e,t){t.prototype=Object.create(e.prototype),t.prototype.constructor=t}function n(e,t){return new Function("f","return function ("+Array.apply(null,Array(e)).map(function(e,t){return"_"+t}).join(",")+") { return f.apply(this, arguments); }")(t)}function r(e){this._error=Error(e),this.message=e}function i(){r.call(this,"internal error")}function o(e,t){var n=e.line+1,i=e.column+1;r.call(this,"syntax error at line "+n+", col "+i+": "+t),this.coordinates=e}function a(){r.call(this,"type error")}function u(e){e?r.call(this,"runtime error: "+e):r.call(this,"runtime error")}function s(e){r.call(this,"user error: "+e.toString()),this.value=e}function l(e){this._hash=e||Object.create(null)}function c(e){l.call(this,e)}function f(e){return["undefined","complex","real","integer","natural","boolean","string","list","lambda","unknown","JavaScript.UNDEFINED","JavaScript.NULL"][e]}function p(){}function h(){p.call(this)}function E(e,t){this.r=+e,this.i=+t}function w(e,t){e=+e,t=+t,h.call(this),this.real=e,this.imaginary=t}function L(e){e=+e,w.call(this,e,0),this.value=e}function A(e){L.call(this,~~e)}function y(e){if(e=~~e,e<0)throw new i;A.call(this,e)}function v(e){e=!!e,h.call(this),this.value=e}function T(){h.call(this)}function d(e){e=""+e,T.call(this),this.value=e}function x(){T.call(this)}function N(e){x.call(this),this.values=e}function R(e){x.call(this),this.array=e}function m(e,t){h.call(this),this.lambda=e,this.capture=t}function O(){p.call(this)}function g(){p.call(this)}function U(){}function F(){U.call(this)}function _(){F.call(this)}function I(){_.call(this)}function b(e){_.call(this),this.name=e}function C(){_.call(this)}function D(){C.call(this)}function S(){D.call(this)}function k(){S.call(this)}function G(){_.call(this)}function P(e){_.call(this),this.inner=e}function B(e){e?P.call(this,this):P.call(this,B.DEFAULT)}function M(e){P.call(this,e)}function X(e,t){_.call(this),this.left=e,this.right=t}function V(){_.call(this)}function q(){_.call(this)}function j(){}function J(e,t){j.call(this),this.value=e,this.type=t}function Y(e){j.call(this),this.expressions=e}function W(e){j.call(this),this.name=e}function $(){j.call(this)}function Z(e,t){j.call(this),this.left=e,this.name=t}function z(e,t){j.call(this),this.expression=e,this.index=t}function K(e,t,n){j.call(this),this.name=e,this.type=t,this.body=n}function H(e,t){j.call(this),this.left=e,this.right=t}function Q(e,t,n){if(e.length<1)throw new i;j.call(this),this.names=e,this.expression=t,this.body=n}function ee(){j.call(this)}function te(e,t,n){j.call(this),this.condition=e,this.thenExpression=t,this.elseExpression=n}function ne(e){j.call(this),this.expression=e}function re(e,t){j.call(this),this.tryExpression=e,this.catchExpression=t}function ie(e,t){j.call(this),this.tryExpression=e,this.finallyExpression=t}function oe(e,t,n){j.call(this),this.tryExpression=e,this.catchExpression=t,this.finallyExpression=n}function ae(e,t){if(t.length!==e.length-1)throw new i;j.call(this),this.expressions=e,this.operators=t}function ue(e,t){j.call(this),this.nativeFunction=e,this.argumentNames=t}function se(e,t){j.call(this),this.nativeFunction=e,this.argumentNames=t}function le(e){return m.fromFunction(function(t){return new L(Math[e](t.value))})}function ce(e){return m.fromFunction(function(t){return new A(Math[e](t.value))})}function fe(e){return m.fromFunction(function(t){return new y(Math[e](t.value))})}function pe(e){function t(){return{offset:s,line:l,column:c}}function n(){s+=f.length,l+=(f.match(/\n/g)||[]).length;var e=f.lastIndexOf("\n");e<0?c+=f.length:c=f.length-1-e}function r(t){var r=t.exec(e);return!!r&&(n(),f=u=r[0],e=e.substr(f.length),!0)}function i(){if(r(/^(\s|(#.*\n))+/))return i();if(r(/^[A-Za-z_\$][A-Za-z0-9_\$]*/))return a=p.contains(u)?"keyword:"+u:"identifier";if(r(/^\-\>/))return a="arrow";if(r(/^\=\>/))return a="fat-arrow";if(r(/^\,/))return a="comma";if(r(/^\./))return a="point";if(r(/^\:/))return a="colon";if(r(/^\(/))return a="left";if(r(/^\)/))return a="right";if(r(/^\[/))return a="left-square";if(r(/^\]/))return a="right-square";if(r(/^\{/))return a="left-curly";if(r(/^\}/))return a="right-curly";if(r(/^(0|[1-9][0-9]*)(\.[0-9]+)?i\b/))return u=parseFloat(u),a="complex";if(r(/^(0|[1-9][0-9]*)\.[0-9]+\b/))return u=parseFloat(u),a="real";if(r(/^0[xX][0-9a-fA-F]+\b/))return u=parseInt(u,16),a="integer";if(r(/^0[0-7]*\b/))return u=parseInt(u,8),a="integer";if(r(/^(0|[1-9][0-9]*)\b/))return u=parseInt(u,10),a="integer";if(r(/^\"([^"\\]|\\\\|\\["bfnrtv])*\"/))return u=u.replace(/^\"|\"$/g,"").replace(/\\\\/g,"\\").replace(/\\\"/g,'"').replace(/\\b/g,"\b").replace(/\\f/g,"\f").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,"\v"),a="string";if(r(/^\'([^'\\]|\\\\|\\['bfnrtv])*\'/))return u=u.replace(/^\'|\'$/g,"").replace(/\\\\/g,"\\").replace(/\\\'/g,"'").replace(/\\b/g,"\b").replace(/\\f/g,"\f").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,"\v"),a="string";if(r(/^(<<|>>)/))return a="symbol";if(r(/^(\!\=|<\=|>\=)/))return a="comparison";if(r(/^\*\*/))return a="power";if(r(/^(<|>)/))return a="comparison";if(r(/^\*/))return a="asterisk";if(r(/^(\/|\%|\&)/))return a="product";if(r(/^(\+|\-|\||\^)/))return a="sum";if(r(/^\=/))return a="equal";if(/^$/.test(e))return u=null,a="end";throw n(),new o(t(),"unrecognized token")}var a,u,s=0,l=0,c=0,f="",p=["undefined","true","false","not","and","or","xor","fix","typeof","boolean","unknown","natural","integer","real","complex","string","regex","fn","let","in","if","then","else","throw","try","catch","finally","error","throws"];i(),this.coordinates=t,this.next=i,this.offset=function(){return s},this.token=function(){return a},this.end=function(){return"end"===a},this.label=function(){return u},this.throwSyntaxError=function(){throw arguments.length?new o(this.coordinates(),[].map.call(arguments,function(e){return"'"+e+"'"}).join(", or ")+" expected, '"+a+"' found"):new o(this.coordinates(),"unexpected token '"+a+"'")},this.expect=function(){for(var e=0;e<arguments.length;e++)if(arguments[e]===a){var t=u;return i(),t}return this.throwSyntaxError.apply(this,arguments)}}function he(e){this.lexer=new pe(e)}Array.prototype.contains=function(){return this.indexOf.apply(this,arguments)>=0},Array.prototype.unique=function(){for(var e=[],t=0;t<this.length;t++)e.indexOf(this[t])<0&&e.push(this[t]);return e},Array.prototype.union=function(){return this.concat.apply(this,arguments).unique()},Array.prototype.difference=function(){var e=Array.prototype.concat.apply([],arguments).unique();return this.filter(function(t){return!e.contains(t)})},Array.prototype.intersection=function(){var e=[].slice(arguments);return this.filter(function(t){return e.every(function(e){return e.contains(t)})})},e.Error=r,r.prototype.toString=function(){return this.message},e.InternalError=i,t(r,i),e.SyntaxError=o,t(r,o),e.TypeError=a,t(r,a),e.RuntimeError=u,t(r,u),e.UserError=s,t(r,s),e.Context=l,l.prototype._marshal=function(e){return e},l.prototype._unmarshal=function(e){return e},l.prototype.has=function(e){return e in this._hash},l.prototype.top=function(e){return this._unmarshal(this._hash[e])},l.prototype.keys=function(){var e=[];for(var t in this._hash)e.push(t);return e},l.prototype.add=function(e,t){var n=Object.create(this._hash);return n[e]=this._marshal(t),new l(n)},l.prototype.addAll=function(e){var t=Object.create(this._hash);for(var n in e)e.hasOwnProperty(n)&&(t[n]=this._marshal(e[n]));return new l(t)},l.prototype.union=function(e,t){var n=Object.create(null);return this.keys().union(e.keys()).forEach(function(r){this.has(r)?e.has(r)?n[r]=t(this.top(r),e.top(r)):n[r]=this.top(r):n[r]=e.top(r)},this),new l(n)},l.prototype.intersection=function(e,t){var n=Object.create(null);return this.keys().intersection(e.keys()).forEach(function(r){n[r]=t(this.top(r),e.top(r))},this),new l(n)},l.prototype.toObject=function(){var e={};return this.keys().forEach(function(t){e[t]=this.top(t).marshal()},this),e},l.EMPTY=new l,e.NativeContext=c,t(l,c),c.prototype._marshal=function(e){return e.marshal()},c.prototype._unmarshal=function(e){return p.unmarshal(e)},c.prototype.toObject=function(){return this._hash};var Ee={UNDEFINED:0,COMPLEX:1,REAL:2,INTEGER:3,NATURAL:4,BOOLEAN:5,STRING:6,LIST:7,LAMBDA:8,UNKNOWN:9,JS:{UNDEFINED:10,NULL:11}};e.Character=Ee,e.AbstractValue=p,p.prototype.is=function(e){return this instanceof e},p.prototype._setContext=function(e){var n=this.constructor,r=function(){n.apply(this,arguments)};return t(n,r),r.prototype.context=e,r},p.prototype._extend=function(e,t){return this._setContext(this.context.add(e,t))},p.prototype.bind=function(){return this},e.UndefinedValue=h,t(p,h),h.prototype.character=Ee.UNDEFINED,h.prototype.context=l.EMPTY,h.prototype.toString=function(){return"undefined"},h.prototype.extend=function(e,t){return new(this._extend(e,t))},h.prototype.marshal=function(){return this.context.toObject()},h.DEFAULT=new h,h.fromContext=function(e){return new(h.DEFAULT._setContext(e))},e.NativeComplexValue=E,E.prototype.toString=function(){return this.i<0?this.r+""+this.i+"i":this.r+"+"+this.i+"i"},e.ComplexValue=w,t(h,w),w.prototype.character=Ee.COMPLEX,w.prototype.toString=function(){return this.imaginary<0?this.real+""+this.imaginary+"i":this.real+"+"+this.imaginary+"i"},w.prototype.extend=function(e,t){return new(this._extend(e,t))(this.real,this.imaginary)},w.prototype.marshal=function(){return new E(this.real,this.imaginary)},e.RealValue=L,t(w,L),L.prototype.character=Ee.REAL,L.prototype.toString=function(){return""+this.value},L.prototype.extend=function(e,t){return new(this._extend(e,t))(this.value)},L.prototype.marshal=function(){return this.value},e.IntegerValue=A,t(L,A),A.prototype.character=Ee.INTEGER,A.prototype.toString=function(){return""+this.value},A.prototype.extend=function(e,t){return new(this._extend(e,t))(this.value)},A.prototype.marshal=function(){return this.value},e.NaturalValue=y,t(A,y),y.prototype.character=Ee.NATURAL,y.prototype.toString=function(){return""+this.value},y.prototype.extend=function(e,t){return new(this._extend(e,t))(this.value)},y.prototype.marshal=function(){return this.value},e.BooleanValue=v,t(h,v),v.prototype.character=Ee.BOOLEAN,v.prototype.toString=function(){return this.value?"true":"false"},v.prototype.extend=function(e,t){return new(this._extend(e,t))(this.value)},v.prototype.marshal=function(){return this.value},v.TRUE=new v((!0)),v.FALSE=new v((!1)),e.IndexedValue=T,t(h,T),e.StringValue=d,t(T,d),d.prototype.character=Ee.STRING,d.prototype.toString=function(){return"'"+this.value.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\'/g,"\\'")+"'"},d.prototype.extend=function(e,t){return new(this._extend(e,t))(this.value)},d.prototype.marshal=function(){return this.value},d.prototype.getLength=function(){return this.value.length},d.prototype.lookup=function(e){if(e<0||e>=this.value.length)throw new u("index "+e+" out of bounds for string "+this.toString());return new d(this.value[e])},e.AbstractListValue=x,t(T,x),e.ListValue=N,t(x,N),N.prototype.character=Ee.LIST,N.prototype.toString=function(){return"{ "+this.values.map(function(e){return e.toString()}).join(", ")+" }"},N.prototype.extend=function(e,t){return new(this._extend(e,t))(this.values)},N.prototype.marshal=function(){return this.values.map(function(e){return e.marshal()})},N.prototype.getLength=function(){return this.values.length},N.prototype.lookup=function(e){if(e<0||e>=this.values.length)throw new u("index "+e+" out of bounds");return this.values[e]},N.prototype.forceList=function(){return this},e.NativeArrayValue=R,t(x,R),R.prototype.character=Ee.LIST,R.prototype.toString=function(){return"{"+this.array.map(function(e){return p.unmarshal(e).toString()}).join(", ")+"}"},R.prototype.extend=function(){return new(this._extend(name,value))(this.array)},R.prototype.marshal=function(){return this.array},R.prototype.getLength=function(){return this.array.length},R.prototype.lookup=function(e){if(e<0||e>=this.array.length)throw new u("index "+e+" out of bounds");return p.unmarshal(this.array[e])},R.prototype.forceList=function(){return new N(this.array.map(function(e){return p.unmarshal(e)}))},e.Closure=m,t(h,m),m.prototype.character=Ee.LAMBDA,m.prototype.toString=function(){return"closure"},m.prototype.extend=function(e,t){return new(this._extend(e,t))(this.lambda,this.capture)},m.prototype.getLength=function(){for(var e=0,t=this.lambda;t.is(K);t=t.body)e++;return e},m.prototype.bind=function(e){return this.lambda.body.evaluate(this.capture.add(this.lambda.name,e))},m.prototype.apply=function(){for(var e=this,t=0;t<arguments.length;t++){if(!e.is(m))throw new u("not a closure");e=e.bind(arguments[t])}return e},m.prototype.marshal=function(){var e=this.lambda,t=this.capture,r=this.getLength(),i="this"===this.lambda.name;return n(r-!!i,function(){var n=[].slice.call(arguments);return i&&n.unshift(this),function e(t,i,o){return o<r?e(t.body,i.add(t.name,p.unmarshal(n[o])),o+1):function(){try{return t.evaluate(i)}catch(e){throw e instanceof s?e.value.marshal():e}}().marshal()}(e,t,0)})},m.fromFunction=function(e){return new m(function t(n,r){if(n<e.length){var i=""+n;return r.push(i),new K(i,_.DEFAULT,t(n+1,r))}return new se(e,r)}(0,[]),l.EMPTY)},m.unmarshal=function(e){return new m(new K("this",null,new K("arguments",new M(_.DEFAULT),new ue(function(t){return e.apply(this,t)},["this","arguments"]))),l.EMPTY)},e.JSUndefinedValue=O,t(p,O),O.prototype.character=Ee.JS.UNDEFINED,O.prototype.toString=function(){return"JavaScript.UNDEFINED"},O.prototype.extend=function(e,t){return new(this._extend(e,t))},O.prototype.marshal=function(){},O.DEFAULT=new O,e.JSNullValue=g,t(p,g),g.prototype.character=Ee.JS.NULL,g.prototype.toString=function(){return"JavaScript.NULL"},g.prototype.extend=function(e,t){return new(this._extend(e,t))},g.prototype.marshal=function(){return null},g.DEFAULT=new g,p.unmarshal=function(e){switch(typeof e){case"undefined":return O.DEFAULT;case"boolean":return new v(e);case"number":return e%1?new L(e):e<0?new A((~~e)):new y((~~e));case"string":return new d(e);case"function":return m.unmarshal(e);case"object":return null===e?g.DEFAULT:e instanceof Boolean||e instanceof Number||e instanceof String?p.unmarshal(e.valueOf()):Array.isArray(e)?new R(e):e instanceof E?new w(e.r,e.i):h.fromContext(new c(e));default:throw new i}},p.getGlobal=function(e){return p.unmarshal(function(){if(!(e in this))throw new u("unknown variable '"+e+"'");try{return this[e]}catch(t){throw new u("unknown variable '"+e+"'")}}())},e.AbstractType=U,U.prototype.is=function(e){return this instanceof e},U.prototype.bind=function(){return this},e.PrototypedType=F,t(U,F),F.prototype.context=l.EMPTY,F.prototype.hasDefaultPrototype=!0,F.prototype._setContext=function(e){var n=this.constructor,r=function(){n.apply(this,arguments)};return t(n,r),r.prototype.context=e,r.prototype.hasDefaultPrototype=!1,r},F.prototype._extend=function(e,t){return this._setContext(this.context.add(e,t))},F.prototype.isSubPrototypeOf=function(e){return e.context.keys().every(function(t){return this.context.has(t)&&this.context.top(t).isSubTypeOf(e.context.top(t))},this)},F.prototype.isSubTypeOf=function(e){return this.isSubCharacterOf(e)&&(e.hasDefaultPrototype||this.isSubPrototypeOf(e))},F.merge=function(e,t){if(e.isSubCharacterOf(t))return t.setContext(e.context.intersection(t.context,F.merge));if(t.isSubCharacterOf(e))return e.setContext(e.context.intersection(t.context,F.merge));throw new a},F.prototype.merge=function(e){return F.merge(this,e)},e.UndefinedType=_,t(F,_),_.prototype.character=Ee.UNDEFINED,_.prototype.toString=function(){return"undefined"},_.prototype.setContext=function(e){return new(this._setContext(e))},_.prototype.extend=function(e,t){return new(this._extend(e,t))},_.prototype.isSubCharacterOf=function(e){return Ee.UNDEFINED===e.character},_.DEFAULT=new _,_.prototype.instance=function(){return this},_.fromContext=function(e){return _.DEFAULT.setContext(e)},e.UnknownType=I,t(_,I),I.prototype.character=Ee.UNKNOWN,I.prototype.toString=function(){return"unknown"},I.DEFAULT=new I,I.prototype.isSubCharacterOf=function(){return!0},I.prototype.isSubPrototypeOf=function(e){return this.context.keys().every(function(t){return e.context.has(t)?this.context.top(t).isSubTypeOf(e.context.top(t)):!!e.is(I)&&this.context.top(t).isSubTypeOf(I.DEFAULT)},this)},I.prototype.isSubTypeOf=function(e){return this.hasDefaultPrototype||this.isSubPrototypeOf(e)},I.prototype.merge=function(e){return e.is(I)?this.setContext(this.context.union(e.context,F.merge)):e.setContext(this.context.intersection(e.context,F.merge))},e.VariableType=b,t(_,b),b.prototype.toString=function(){return this.name},b.prototype.setContext=function(e){return new(this._setContext(e))(this.name)},b.prototype.extend=function(e,t){return new(this._extend(e,t))(this.name)},b.prototype.isSubCharacterOf=function(){},b.prototype.isSubPrototypeOf=function(e){return this.context.keys().every(function(t){return!!e.context.has(t)&&this.context.top(t).isSubTypeOf(e.context.top(t))},this)},b.prototype.isSubTypeOf=function(e){return _.prototype.isSubTypeOf.call(this,e)&&(!e.is(b)||e.name===this.name)},b.prototype.merge=function(){return I.DEFAULT},b.prototype.instance=function(e,t){return this.name!==e?this:t},e.ComplexType=C,t(_,C),C.prototype.character=Ee.COMPLEX,C.prototype.toString=function(){return"complex"},C.prototype.isSubCharacterOf=function(e){return Ee.UNDEFINED===e.character||Ee.COMPLEX===e.character},C.DEFAULT=new C,e.RealType=D,t(C,D),D.prototype.character=Ee.REAL,D.prototype.toString=function(){return"real"},D.prototype.isSubCharacterOf=function(e){return Ee.UNDEFINED===e.character||Ee.COMPLEX===e.character||Ee.REAL===e.character},D.DEFAULT=new D,e.IntegerType=S,t(D,S),S.prototype.character=Ee.INTEGER,S.prototype.toString=function(){return"integer"},S.prototype.isSubCharacterOf=function(e){return Ee.UNDEFINED===e.character||Ee.COMPLEX===e.character||Ee.REAL===e.character||Ee.INTEGER===e.character},S.DEFAULT=new S,e.NaturalType=k,t(S,k),k.prototype.character=Ee.NATURAL,k.prototype.toString=function(){return"natural"},k.prototype.isSubCharacterOf=function(e){return Ee.UNDEFINED===e.character||Ee.COMPLEX===e.character||Ee.REAL===e.character||Ee.INTEGER===e.character||Ee.NATURAL===e.character},k.DEFAULT=new k,e.BooleanType=G,t(_,G),G.prototype.character=Ee.BOOLEAN,G.prototype.toString=function(){return"boolean"},G.prototype.isSubCharacterOf=function(e){return Ee.UNDEFINED===e.character||Ee.BOOLEAN===e.character},G.DEFAULT=new G,e.IndexedType=P,t(_,P),e.StringType=B,t(P,B),B.prototype.character=Ee.STRING,B.prototype.toString=function(){return"string"},B.prototype.isSubCharacterOf=function(e){return Ee.UNDEFINED===e.character||Ee.STRING===e.character},B.DEFAULT=new B((!0)),e.ListType=M,t(P,M),M.prototype.character=Ee.LIST,M.prototype.toString=function(){return"("+this.inner.toString()+")*"},M.prototype.setContext=function(e){return new(this._setContext(e))(this.inner)},M.prototype.extend=function(e,t){return new(this._extend(e,t))(this.inner)},M.prototype.isSubCharacterOf=function(e){return Ee.UNDEFINED===e.character||Ee.LIST===e.character},M.prototype.isSubTypeOf=function(e){return _.prototype.isSubTypeOf.call(this,e)&&(!e.is(P)||this.inner.isSubTypeOf(e.inner))},M.prototype.instance=function(e,t){return new(this._setContext(this.context))(this.inner.instance(e,t))},e.LambdaType=X,t(_,X),X.prototype.character=Ee.LAMBDA,X.prototype.toString=function(){return"("+this.left.toString()+") => ("+this.right.toString()+")"},X.prototype.setContext=function(e){return new(this._setContext(e))(this.left,this.right)};X.prototype.extend=function(e,t){return new(this._extend(e,t))(this.left,this.right)};X.prototype.isSubCharacterOf=function(e){return Ee.UNDEFINED===e.character||Ee.LAMBDA===e.character},X.prototype.isSubTypeOf=function(e){return _.prototype.isSubTypeOf.call(this,e)&&(!e.is(X)||e.left.isSubTypeOf(this.left)&&this.right.isSubTypeOf(e.right))},X.prototype.instance=function(e,t){return new(this._setContext(this.context))(this.left.instance(e,t),this.right.instance(e,t))},X.prototype.bind=function(e){if(this.left.is(b))return this.right.instance(this.left.name,e);if(e.isSubTypeOf(this.left))return this.right;throw new a},e.JSUndefinedType=V,t(_,V),V.prototype.character=Ee.JS.UNDEFINED,V.prototype.toString=function(){return"JavaScript.UNDEFINED"},V.prototype.isSubCharacterOf=function(e){return Ee.UNDEFINED===e.character},V.DEFAULT=new V,e.JSNullType=q,t(_,q),q.prototype.character=Ee.JS.NULL,q.prototype.toString=function(){return"JavaScript.NULL"},q.prototype.isSubCharacterOf=function(e){return Ee.NULL===e.character},q.DEFAULT=new q,e.AbstractNode=j,j.prototype.is=function(e){return this instanceof e},e.LiteralNode=J,t(j,J),J.prototype.getFreeVariables=function(){return[]},J.prototype.getType=function(){return this.type},J.prototype.evaluate=function(){return this.value},e.ListLiteralNode=Y,t(j,Y),Y.prototype.getFreeVariables=function(){return this.expressions.reduce(function(e,t){return e.union(t.getFreeVariables())},[])},Y.prototype.getType=function(e){return new M(this.expressions.map(function(t){return t.getType(e)}).reduce(function(e,t){return e.merge(t)},I.DEFAULT))},Y.prototype.evaluate=function(e){return new N(this.expressions.map(function(t){return t.evaluate(e)}))},e.VariableNode=W,t(j,W),W.prototype.getFreeVariables=function(){return[this.name]},W.prototype.getType=function(e){return e.has(this.name)?e.top(this.name):I.DEFAULT},W.prototype.evaluate=function(e){return e.has(this.name)?e.top(this.name):p.getGlobal(this.name)},e.ErrorNode=$,t(j,$),$.prototype.getFreeVariables=function(){return["error"]},$.prototype.getType=function(e){if(e.has("error"))return e.top("error");throw new a},$.prototype.evaluate=function(e){if(e.has("error"))return e.top("error");throw new u("'error' may be used only within 'catch' statements")},$.INSTANCE=new $,e.FieldAccessNode=Z,t(j,Z),Z.prototype.getFreeVariables=function(){return this.left.getFreeVariables()},Z.prototype.getType=function(e){var t=this.left.getType(e);if(t.is(I))return t.context.has(this.name)?t.context.top(this.name).bind(t):I.DEFAULT;if(t.context.has(this.name))return t.context.top(this.name).bind(t);throw new a},Z.prototype.evaluate=function(e){var t=this.left.evaluate(e);if(t.context.has(this.name))return t.context.top(this.name).bind(t);throw new u("unknown field '"+this.name+"'")},e.SubscriptNode=z,t(j,z),z.prototype.getFreeVariables=function(){return this.expression.getFreeVariables().union(this.index.getFreeVariables())},z.prototype.getType=function(e){var t=this.expression.getType(e),n=this.index.getType(e);if(n.isSubTypeOf(S.DEFAULT)){if(t.is(P))return t.inner;if(t.is(I))return I.DEFAULT;throw new a}throw new a},z.prototype.evaluate=function(e){var t=this.expression.evaluate(e),n=this.index.evaluate(e);if(t.is(T)&&n.is(A))return t.lookup(n.value);throw new u("not a list or string")},e.LambdaNode=K,t(j,K),K.prototype.getFreeVariables=function(){return this.body.getFreeVariables().filter(function(e){return e!==this.name},this)},K.prototype.getType=function(e){var t=this.type;return t||(t=new b(this.name)),new X(t,this.body.getType(e.add(this.name,t)))},K.prototype.evaluate=function(e){return new m(this,e)},e.ApplicationNode=H,t(j,H),H.prototype.getFreeVariables=function(){return this.left.getFreeVariables().union(this.right.getFreeVariables())},H.prototype.getType=function(e){var t=this.left.getType(e),n=this.right.getType(e);if(t.is(X)||t.is(I))return t.bind(n);throw new a},H.prototype.evaluate=function(e){var t=this.left.evaluate(e),n=this.right.evaluate(e);if(t.is(m))return t.bind(n);throw new u("left-hand side of an application must be a closure")},e.LetNode=Q,t(j,Q),Q.prototype.getFreeVariables=function(){return this.body.getFreeVariables().filter(function(e){return e!==this.names[0]},this).union(this.expression.getFreeVariables())},Q.prototype.getType=function(e){var t=e,n=function e(n,r){var i=this.names[r];return r<this.names.length-1?n.context.has(i)?n.extend(i,e.call(this,n.context.top(i),r+1)):n.extend(i,e.call(this,_.DEFAULT,r+1)):n.extend(i,this.expression.getType(t))}.call(this,_.fromContext(e),0);return this.body.getType(n.context)},Q.prototype.evaluate=function(e){var t=e,n=function e(n,r){var i=this.names[r];return r<this.names.length-1?n.context.has(i)?n.extend(i,e.call(this,n.context.top(i),r+1)):n.extend(i,e.call(this,h.DEFAULT,r+1)):n.extend(i,this.expression.evaluate(t))}.call(this,h.fromContext(e),0);return this.body.evaluate(n.context)},e.FixNode=ee,t(j,ee),ee.prototype.getFreeVariables=function(){return[]},ee.TYPE=new X(new X(new b("T"),new b("T")),new b("T")),ee.prototype.getType=function(){return ee.TYPE},ee.Z_COMBINATOR=new K("f",null,new H(new K("x",null,new H(new W("f"),new K("v",null,new H(new H(new W("x"),new W("x")),new W("v"))))),new K("x",null,new H(new W("f"),new K("v",null,new H(new H(new W("x"),new W("x")),new W("v"))))))).evaluate(l.EMPTY),ee.prototype.evaluate=function(){return ee.Z_COMBINATOR},ee.INSTANCE=new ee,e.IfNode=te,t(j,te),te.prototype.getFreeVariables=function(){return this.condition.getFreeVariables().union(this.thenExpression.getFreeVariables()).union(this.elseExpression.getFreeVariables())},te.prototype.getType=function(e){var t=this.condition.getType(e);if(t.isSubTypeOf(G.DEFAULT))return this.thenExpression.getType(e).merge(this.elseExpression.getType(e));throw new a},te.prototype.evaluate=function(e){var t=this.condition.evaluate(e);if(t.is(v))return t.value?this.thenExpression.evaluate(e):this.elseExpression.evaluate(e);throw new u("'if' condition must be boolean")},e.ThrowNode=ne,t(j,ne),ne.prototype.getFreeVariables=function(){return this.expression.getFreeVariables()},ne.prototype.getType=function(){},ne.prototype.evaluate=function(e){throw new s(this.expression.evaluate(e))},e.TryCatchNode=re,t(j,re),re.prototype.getFreeVariables=function(){return this.tryExpression.getFreeVariables().union(this.catchExpression.getFreeVariables().filter(function(e){return"error"!==e}))},re.prototype.getType=function(){},re.prototype.evaluate=function(e){try{return this.tryExpression.evaluate(e)}catch(t){if(t instanceof s)return this.catchExpression.evaluate(e.add("error",t.value));throw t}},e.TryFinallyNode=ie,t(j,ie),ie.prototype.getFreeVariables=function(){return this.tryExpression.getFreeVariables().union(this.finallyExpression.getFreeVariables())},ie.prototype.getType=function(){},ie.prototype.evaluate=function(e){try{return this.tryExpression.evaluate(e)}finally{this.finallyExpression.evaluate(e)}},e.TryCatchFinallyNode=oe,t(j,oe),oe.prototype.getFreeVariables=function(){return this.tryExpression.getFreeVariables().union(this.catchExpression.getFreeVariables().filter(function(e){return"error"!==e})).union(this.finallyExpression.getFreeVariables())},oe.prototype.getType=function(){},oe.prototype.evaluate=function(e){try{return this.tryExpression.evaluate(e)}catch(t){if(t instanceof s)return this.catchExpression.evaluate(e.add("error",t.value));throw t}finally{this.finallyExpression.evaluate(e)}},e.ChainedComparisonNode=ae,t(j,ae),ae.prototype.getFreeVariables=function(){return this.expressions.reduce(function(e,t){return e.concat(t.getFreeVariables())},[]).union(this.operators.reduce(function(e,t){return e.concat(t.getFreeVariables())},[]))},ae.prototype.getType=function(e){for(var t=this.expressions.map(function(t){return t.getType(e)}),n=this.operators.map(function(t){return t.getType(e)}),r=0;r<n.length;r++){if(!n[r].is(X)&&!n[r].is(I))throw new a;var i=n[r].bind(t[r]);if(!i.is(X)&&!i.is(I))throw new a;var o=i.bind(t[r+1]);if(!o.isSubTypeOf(G.DEFAULT))throw new a}return G.DEFAULT},ae.prototype.evaluate=function(e){for(var t=this.expressions.map(function(t){return t.evaluate(e)}),n=this.operators.map(function(t){return t.evaluate(e)}),r=0;r<n.length;r++){if(!n[r].is(m))throw new u;var i=n[r].bind(t[r]);if(!i.is(m))throw new u;var o=i.bind(t[r+1]);if(!o.is(v))throw new u;if(!o.value)return v.FALSE}return v.TRUE},e.NativeNode=ue,t(j,ue),ue.prototype.getFreeVariables=function(){return this.argumentNames},ue.prototype.getType=function(){return I.DEFAULT},ue.prototype.evaluate=function(e){var t=this.argumentNames.map(function(t){if(e.has(t))return e.top(t).marshal();throw new i}),n=t.shift();return p.unmarshal(function(){try{return this.nativeFunction.apply(n,t)}catch(e){throw e instanceof r?e:new s(p.unmarshal(e))}}.call(this))},e.SemiNativeNode=se,t(j,se),se.prototype.getFreeVariables=function(){return this.argumentNames},se.prototype.getType=function(){return I.DEFAULT},se.prototype.evaluate=function(e){return this.nativeFunction.apply(null,this.argumentNames.map(function(t){if(e.has(t))return e.top(t);throw new i}))},C.prototype.context=C.prototype.context.addAll({str:B.DEFAULT,real:D.DEFAULT,imaginary:D.DEFAULT,abs:D.DEFAULT}),w.prototype.context=w.prototype.context.addAll({str:m.fromFunction(function(e){return new d(e.toString())}),real:m.fromFunction(function(e){return new L(e.real)}),imaginary:m.fromFunction(function(e){return new L(e.imaginary)}),abs:m.fromFunction(function(e){return new L(Math.sqrt(e.real*e.real+e.imaginary*e.imaginary))})}),D.prototype.context=D.prototype.context.addAll({ceil:S.DEFAULT,floor:S.DEFAULT,round:S.DEFAULT,trunc:S.DEFAULT,sign:S.DEFAULT,sqrt:D.DEFAULT,cbrt:D.DEFAULT,exp:D.DEFAULT,expm1:D.DEFAULT,log:D.DEFAULT,log10:D.DEFAULT,log2:D.DEFAULT,sin:D.DEFAULT,cos:D.DEFAULT,tan:D.DEFAULT,asin:D.DEFAULT,acos:D.DEFAULT,atan:D.DEFAULT,sinh:D.DEFAULT,cosh:D.DEFAULT,tanh:D.DEFAULT,asinh:D.DEFAULT,acosh:D.DEFAULT,atanh:D.DEFAULT}),L.prototype.context=L.prototype.context.addAll({abs:le("abs"),ceil:ce("ceil"),floor:ce("floor"),round:ce("round"),trunc:ce("trunc"),sign:ce("sign"),sqrt:le("sqrt"),cbrt:le("cbrt"),exp:le("exp"),expm1:le("expm1"),log:le("log"),log10:le("log10"),log2:le("log2"),sin:le("sin"),cos:le("cos"),tan:le("tan"),asin:le("asin"),acos:le("acos"),atan:le("atan"),sinh:le("sinh"),cosh:le("cosh"),tanh:le("tanh"),asinh:le("asinh"),acosh:le("acosh"),atanh:le("atanh")}),S.prototype.context=S.prototype.context.addAll({abs:k.DEFAULT}),A.prototype.context=A.prototype.context.addAll({abs:fe("abs")}),G.prototype.context=G.prototype.context.addAll({str:B.DEFAULT}),v.prototype.context=v.prototype.context.addAll({str:m.fromFunction(function(e){return new d(e.toString())})}),B.prototype.context=B.prototype.context.addAll({length:k.DEFAULT,str:B.DEFAULT,startsWith:new X(B.DEFAULT,new X(B.DEFAULT,G.DEFAULT)),endsWith:new X(B.DEFAULT,new X(B.DEFAULT,G.DEFAULT)),trim:new X(B.DEFAULT,B.DEFAULT),trimLeft:new X(B.DEFAULT,B.DEFAULT),trimRight:new X(B.DEFAULT,B.DEFAULT),reverse:new X(B.DEFAULT,B.DEFAULT)}),d.prototype.context=d.prototype.context.addAll({length:m.fromFunction(function(e){return new y(e.value.length)}),str:m.fromFunction(function(e){return e}),startsWith:m.fromFunction(function(e,t){return new d(e.value.startsWith(t.value))}),endsWith:m.fromFunction(function(e,t){return new d(e.value.endsWith(t.value))}),trim:m.fromFunction(function(e){return new d(e.value.trim())}),trimLeft:m.fromFunction(function(e){return new d(e.value.trimLeft())}),trimRight:m.fromFunction(function(e){return new d(e.value.trimRight())}),reverse:m.fromFunction(function(e){return new d(e.value.split("").reverse().join(""))})}),M.prototype.context=M.prototype.context.addAll({length:k.DEFAULT,empty:G.DEFAULT,head:new X(new M(new b("T")),new b("T")),tail:new X(new M(new b("T")),new M(new b("T"))),append:new X(new M(new b("T")),new X(new b("T"),new M(new b("T")))),concat:new X(new M(new b("T")),new X(new M(new b("T")),new M(new b("T")))),slice:new X(new M(new b("T")),new X(k.DEFAULT,new X(k.DEFAULT,new M(new b("T"))))),reverse:new X(new M(new b("T")),new M(new b("T"))),sort:new X(new M(new b("T")),new X(new X(new b("T"),new X(new b("T"),G.DEFAULT)),new M(new b("T")))),each:new X(new M(new b("T")),new X(new X(new b("T"),_.DEFAULT),_.DEFAULT)),some:new X(new M(new b("T")),new X(new X(new b("T"),G.DEFAULT),G.DEFAULT)),
every:new X(new M(new b("T")),new X(new X(new b("T"),G.DEFAULT),G.DEFAULT)),filter:new X(new M(new b("T")),new X(new X(new b("T"),G.DEFAULT),new M(new b("T")))),map:new X(new M(new b("A")),new X(new X(new b("A"),new b("B")),new M(new b("B")))),reduce:new X(new M(new b("A")),new X(new b("B"),new X(new X(new b("B"),new X(new b("A"),new b("B"))),new b("B")))),join:new X(new M(B.DEFAULT),new X(B.DEFAULT,B.DEFAULT)),min:new X(new M(new b("T")),new b("T")),max:new X(new M(new b("T")),new b("T"))}),x.prototype.context=x.prototype.context.addAll({length:m.fromFunction(function(e){return new y(e.getLength())}),empty:m.fromFunction(function(e){return new v((!e.getLength()))}),head:m.fromFunction(function(e){return e.lookup(0)}),tail:m.fromFunction(function(e){return new N(e.forceList().values.slice(1))}),append:m.fromFunction(function(e,t){return new N(e.forceList().values.concat(t))}),concat:m.fromFunction(function(e,t){if(t.is(x))return new N(e.forceList().values.concat(t.forceList().values));throw new u}),slice:m.fromFunction(function(e,t,n){if(t.is(A)&&n.is(A))return new N(e.forceList().values.slice(t.value,n.value));throw new u}),reverse:m.fromFunction(function(e){return new N(e.forceList().values.reverse())}),sort:m.fromFunction(function(e,t){if(!t.is(m))throw new u;var n=function(e,n){var r=t.apply(e,n);if(r.is(v))return r.value;throw new u};return new N(e.forceList().values.sort(function(e,t){return n(e,t)?n(t,e)?0:-1:1}))}),each:m.fromFunction(function(e,t){if(t.is(m))return e.forceList().values.forEach(function(e){t.apply(e)}),h.DEFAULT;throw new u}),some:m.fromFunction(function(e,t){if(t.is(m))return new v(e.forceList().values.some(function(e){var n=t.apply(e);if(n.is(v))return n.value;throw new u}));throw new u}),every:m.fromFunction(function(e,t){if(t.is(m))return new v(e.forceList().values.every(function(e){var n=t.apply(e);if(n.is(v))return n.value;throw new u}));throw new u}),filter:m.fromFunction(function(e,t){if(t.is(m))return new N(e.forceList().values.filter(function(e){var n=t.apply(e);if(n.is(v))return n.value;throw new u}));throw new u}),map:m.fromFunction(function(e,t){if(t.is(m))return new N(e.forceList().values.map(function(e){return t.apply(e)}));throw new u}),reduce:m.fromFunction(function(e,t,n){if(n.is(m))return e.forceList().values.reduce(function(e,t){var r=n.apply(e);if(r.is(m))return r.apply(t);throw new u},t);throw new u}),join:m.fromFunction(function(e,t){if(t.is(d))return new d(e.forceList().values.map(function(e){if(e.is(d))return e.value;throw new u}).join(t.value));throw new u}),min:m.fromFunction(function(e){if(e.getLength()){for(var t=e.lookup(0),n=1;n<e.values.length;n++){var r=e.lookup(n),i=we.select("<",r.character,t.character);i.handler(r,t).value&&(t=r)}return t}throw new u("cannot retrieve the minimum of an empty list")}),max:m.fromFunction(function(e){if(e.getLength()){for(var t=e.lookup(0),n=1;n<e.values.length;n++){var r=e.lookup(n),i=we.select(">",r.character,t.character);i.handler(r,t).value&&(t=r)}return t}throw new u("cannot retrieve the maximum of an empty list")})});var we={_table:Object.create(null)};we._define=function(e,t,n,r,o){if(e in we._table||(we._table[e]=Object.create(null)),t in we._table[e]||(we._table[e][t]=Object.create(null)),n in we._table[e][t])throw new i;we._table[e][t][n]={type:r,handler:o}},we.select=function(e,t,n){if(e in we._table&&t in we._table[e]&&n in we._table[e][t])return we._table[e][t][n];throw new u},we.make=function(e){return m.fromFunction(function(t,n){return we.select(e,t.character,n.character).handler(t,n)})},we._define("+",Ee.COMPLEX,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w(e.real+t.real,e.imaginary+t.imaginary)}),we._define("+",Ee.COMPLEX,Ee.REAL,Ee.COMPLEX,function(e,t){return new w(e.real+t.value,e.imaginary)}),we._define("+",Ee.COMPLEX,Ee.INTEGER,Ee.COMPLEX,function(e,t){return new w(e.real+t.value,e.imaginary)}),we._define("+",Ee.COMPLEX,Ee.NATURAL,Ee.COMPLEX,function(e,t){return new w(e.real+t.value,e.imaginary)}),we._define("+",Ee.REAL,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w(e.value+t.real,t.imaginary)}),we._define("+",Ee.REAL,Ee.REAL,Ee.REAL,function(e,t){return new L(e.value+t.value)}),we._define("+",Ee.REAL,Ee.INTEGER,Ee.REAL,function(e,t){return new L(e.value+t.value)}),we._define("+",Ee.REAL,Ee.NATURAL,Ee.REAL,function(e,t){return new L(e.value+t.value)}),we._define("+",Ee.INTEGER,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w(e.value+t.real,t.imaginary)}),we._define("+",Ee.INTEGER,Ee.REAL,Ee.REAL,function(e,t){return new L(e.value+t.value)}),we._define("+",Ee.INTEGER,Ee.INTEGER,Ee.INTEGER,function(e,t){return new A(e.value+t.value)}),we._define("+",Ee.INTEGER,Ee.NATURAL,Ee.INTEGER,function(e,t){return new A(e.value+t.value)}),we._define("+",Ee.NATURAL,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w(e.value+t.real,t.imaginary)}),we._define("+",Ee.NATURAL,Ee.REAL,Ee.REAL,function(e,t){return new L(e.value+t.value)}),we._define("+",Ee.NATURAL,Ee.INTEGER,Ee.INTEGER,function(e,t){return new A(e.value+t.value)}),we._define("+",Ee.NATURAL,Ee.NATURAL,Ee.NATURAL,function(e,t){return new y(e.value+t.value)}),we._define("+",Ee.STRING,Ee.STRING,Ee.STRING,function(e,t){return new d(e.value+t.value)}),we._define("+",Ee.LIST,Ee.LIST,Ee.LIST,function(e,t){return new N(e.forceList().values.concat(t.forceList().values))}),we._define("-",Ee.COMPLEX,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w(e.real-t.real,e.imaginary-t.imaginary)}),we._define("-",Ee.COMPLEX,Ee.REAL,Ee.COMPLEX,function(e,t){return new w(e.real-t.value,e.imaginary)}),we._define("-",Ee.COMPLEX,Ee.INTEGER,Ee.COMPLEX,function(e,t){return new w(e.real-t.value,e.imaginary)}),we._define("-",Ee.COMPLEX,Ee.NATURAL,Ee.COMPLEX,function(e,t){return new w(e.real-t.value,e.imaginary)}),we._define("-",Ee.REAL,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w(e.value-t.real,(-t.imaginary))}),we._define("-",Ee.REAL,Ee.REAL,Ee.REAL,function(e,t){return new L(e.value-t.value)}),we._define("-",Ee.REAL,Ee.INTEGER,Ee.REAL,function(e,t){return new L(e.value-t.value)}),we._define("-",Ee.REAL,Ee.NATURAL,Ee.REAL,function(e,t){return new L(e.value-t.value)}),we._define("-",Ee.INTEGER,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w(e.value-t.real,(-t.imaginary))}),we._define("-",Ee.INTEGER,Ee.REAL,Ee.REAL,function(e,t){return new L(e.value-t.value)}),we._define("-",Ee.INTEGER,Ee.INTEGER,Ee.INTEGER,function(e,t){return new A(e.value-t.value)}),we._define("-",Ee.INTEGER,Ee.NATURAL,Ee.INTEGER,function(e,t){return new A(e.value-t.value)}),we._define("-",Ee.NATURAL,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w(e.value-t.real,(-t.imaginary))}),we._define("-",Ee.NATURAL,Ee.REAL,Ee.REAL,function(e,t){return new L(e.value-t.value)}),we._define("-",Ee.NATURAL,Ee.INTEGER,Ee.INTEGER,function(e,t){return new A(e.value-t.value)}),we._define("-",Ee.NATURAL,Ee.NATURAL,Ee.INTEGER,function(e,t){return new A(e.value-t.value)}),we._define("|",Ee.INTEGER,Ee.INTEGER,Ee.INTEGER,function(e,t){return new A(e.value|t.value)}),we._define("|",Ee.INTEGER,Ee.NATURAL,Ee.INTEGER,function(e,t){return new A(e.value|t.value)}),we._define("|",Ee.NATURAL,Ee.INTEGER,Ee.INTEGER,function(e,t){return new A(e.value|t.value)}),we._define("|",Ee.NATURAL,Ee.NATURAL,Ee.NATURAL,function(e,t){return new y(e.value|t.value)}),we._define("^",Ee.INTEGER,Ee.INTEGER,Ee.INTEGER,function(e,t){return new A(e.value^t.value)}),we._define("^",Ee.INTEGER,Ee.NATURAL,Ee.INTEGER,function(e,t){return new A(e.value^t.value)}),we._define("^",Ee.NATURAL,Ee.INTEGER,Ee.INTEGER,function(e,t){return new A(e.value^t.value)}),we._define("^",Ee.NATURAL,Ee.NATURAL,Ee.NATURAL,function(e,t){return new y(e.value^t.value)}),we._define("*",Ee.COMPLEX,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w(e.real*t.real-e.imaginary*t.imaginary,e.real*t.imaginary+t.real*e.imaginary)}),we._define("*",Ee.COMPLEX,Ee.REAL,Ee.COMPLEX,function(e,t){return new w(e.real*t.value,e.imaginary*t.value)}),we._define("*",Ee.COMPLEX,Ee.INTEGER,Ee.COMPLEX,function(e,t){return new w(e.real*t.value,e.imaginary*t.value)}),we._define("*",Ee.COMPLEX,Ee.NATURAL,Ee.COMPLEX,function(e,t){return new w(e.real*t.value,e.imaginary*t.value)}),we._define("*",Ee.REAL,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w(e.value*t.real,e.value*t.imaginary)}),we._define("*",Ee.REAL,Ee.REAL,Ee.REAL,function(e,t){return new L(e.value*t.value)}),we._define("*",Ee.REAL,Ee.INTEGER,Ee.REAL,function(e,t){return new L(e.value*t.value)}),we._define("*",Ee.REAL,Ee.NATURAL,Ee.REAL,function(e,t){return new L(e.value*t.value)}),we._define("*",Ee.INTEGER,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w(e.value*t.real,e.value*t.imaginary)}),we._define("*",Ee.INTEGER,Ee.REAL,Ee.REAL,function(e,t){return new L(e.value*t.value)}),we._define("*",Ee.INTEGER,Ee.INTEGER,Ee.INTEGER,function(e,t){return new A(e.value*t.value)}),we._define("*",Ee.INTEGER,Ee.NATURAL,Ee.INTEGER,function(e,t){return new A(e.value*t.value)}),we._define("*",Ee.NATURAL,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w(e.value*t.real,e.value*t.imaginary)}),we._define("*",Ee.NATURAL,Ee.REAL,Ee.REAL,function(e,t){return new L(e.value*t.value)}),we._define("*",Ee.NATURAL,Ee.INTEGER,Ee.INTEGER,function(e,t){return new A(e.value*t.value)}),we._define("*",Ee.NATURAL,Ee.NATURAL,Ee.NATURAL,function(e,t){return new y(e.value*t.value)}),we._define("/",Ee.COMPLEX,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w((e.real*t.real+e.imaginary*t.imaginary)/(t.real*t.real+t.imaginary*t.imaginary),(e.imaginary*t.real-e.real*t.imaginary)/(t.real*t.real+t.imaginary*t.imaginary))}),we._define("/",Ee.COMPLEX,Ee.REAL,Ee.COMPLEX,function(e,t){return new w(e.real/t.value,e.imaginary/t.value)}),we._define("/",Ee.COMPLEX,Ee.INTEGER,Ee.COMPLEX,function(e,t){return new w(e.real/t.value,e.imaginary/t.value)}),we._define("/",Ee.COMPLEX,Ee.NATURAL,Ee.COMPLEX,function(e,t){return new w(e.real/t.value,e.imaginary/t.value)}),we._define("/",Ee.REAL,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w(e.value*t.real/(t.real*t.real+t.imaginary*t.imaginary),-e.value*t.imaginary/(t.real*t.real+t.imaginary*t.imaginary))}),we._define("/",Ee.REAL,Ee.REAL,Ee.REAL,function(e,t){return new L(e.value/t.value)}),we._define("/",Ee.REAL,Ee.INTEGER,Ee.REAL,function(e,t){return new L(e.value/t.value)}),we._define("/",Ee.REAL,Ee.NATURAL,Ee.REAL,function(e,t){return new L(e.value/t.value)}),we._define("/",Ee.INTEGER,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w(e.value*t.real/(t.real*t.real+t.imaginary*t.imaginary),-e.value*t.imaginary/(t.real*t.real+t.imaginary*t.imaginary))}),we._define("/",Ee.INTEGER,Ee.REAL,Ee.REAL,function(e,t){return new L(e.value/t.value)}),we._define("/",Ee.INTEGER,Ee.INTEGER,Ee.REAL,function(e,t){return new L(e.value/t.value)}),we._define("/",Ee.INTEGER,Ee.NATURAL,Ee.REAL,function(e,t){return new L(e.value/t.value)}),we._define("/",Ee.NATURAL,Ee.COMPLEX,Ee.COMPLEX,function(e,t){return new w(e.value*t.real/(t.real*t.real+t.imaginary*t.imaginary),-e.value*t.imaginary/(t.real*t.real+t.imaginary*t.imaginary))}),we._define("/",Ee.NATURAL,Ee.REAL,Ee.REAL,function(e,t){return new L(e.value/t.value)}),we._define("/",Ee.NATURAL,Ee.INTEGER,Ee.REAL,function(e,t){return new L(e.value/t.value)}),we._define("/",Ee.NATURAL,Ee.NATURAL,Ee.REAL,function(e,t){return new L(e.value/t.value)}),we._define("%",Ee.REAL,Ee.REAL,Ee.REAL,function(e,t){return new L(e.value%t.value)}),we._define("%",Ee.REAL,Ee.INTEGER,Ee.REAL,function(e,t){return new L(e.value%t.value)}),we._define("%",Ee.REAL,Ee.NATURAL,Ee.REAL,function(e,t){return new L(e.value%t.value)}),we._define("%",Ee.INTEGER,Ee.REAL,Ee.REAL,function(e,t){return new L(e.value%t.value)}),we._define("%",Ee.INTEGER,Ee.INTEGER,Ee.INTEGER,function(e,t){return new A(e.value%t.value)}),we._define("%",Ee.INTEGER,Ee.NATURAL,Ee.INTEGER,function(e,t){return new A(e.value%t.value)}),we._define("%",Ee.NATURAL,Ee.REAL,Ee.REAL,function(e,t){return new L(e.value%t.value)}),we._define("%",Ee.NATURAL,Ee.INTEGER,Ee.NATURAL,function(e,t){return new y(e.value%t.value)}),we._define("%",Ee.NATURAL,Ee.NATURAL,Ee.NATURAL,function(e,t){return new y(e.value%t.value)}),we._define("&",Ee.INTEGER,Ee.INTEGER,Ee.INTEGER,function(e,t){return new A(e.value&t.value)}),we._define("&",Ee.INTEGER,Ee.NATURAL,Ee.INTEGER,function(e,t){return new A(e.value&t.value)}),we._define("&",Ee.NATURAL,Ee.INTEGER,Ee.INTEGER,function(e,t){return new A(e.value&t.value)}),we._define("&",Ee.NATURAL,Ee.NATURAL,Ee.NATURAL,function(e,t){return new y(e.value&t.value)}),we._define("**",Ee.REAL,Ee.REAL,Ee.REAL,function(e,t){return new L(Math.pow(e.value,t.value))}),we._define("**",Ee.REAL,Ee.INTEGER,Ee.REAL,function(e,t){return new L(Math.pow(e.value,t.value))}),we._define("**",Ee.REAL,Ee.NATURAL,Ee.REAL,function(e,t){return new L(Math.pow(e.value,t.value))}),we._define("**",Ee.INTEGER,Ee.REAL,Ee.REAL,function(e,t){return new L(Math.pow(e.value,t.value))}),we._define("**",Ee.INTEGER,Ee.INTEGER,Ee.REAL,function(e,t){return new L(Math.pow(e.value,t.value))}),we._define("**",Ee.INTEGER,Ee.NATURAL,Ee.INTEGER,function(e,t){return new A(Math.pow(e.value,t.value))}),we._define("**",Ee.NATURAL,Ee.REAL,Ee.REAL,function(e,t){return new L(Math.pow(e.value,t.value))}),we._define("**",Ee.NATURAL,Ee.INTEGER,Ee.REAL,function(e,t){return new L(Math.pow(e.value,t.value))}),we._define("**",Ee.NATURAL,Ee.NATURAL,Ee.NATURAL,function(e,t){return new y(Math.pow(e.value,t.value))}),we._define("=",Ee.COMPLEX,Ee.COMPLEX,Ee.BOOLEAN,function(e,t){return new v(e.real===t.real&&e.imaginary===t.imaginary)}),we._define("=",Ee.COMPLEX,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.real===t.value&&!e.imaginary)}),we._define("=",Ee.COMPLEX,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.real===t.value&&!e.imaginary)}),we._define("=",Ee.COMPLEX,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.real===t.value&&!e.imaginary)}),we._define("=",Ee.REAL,Ee.COMPLEX,Ee.BOOLEAN,function(e,t){return new v(e.value===t.real&&!t.imaginary)}),we._define("=",Ee.REAL,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value===t.value)}),we._define("=",Ee.REAL,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value===t.value)}),we._define("=",Ee.REAL,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value===t.value)}),we._define("=",Ee.INTEGER,Ee.COMPLEX,Ee.BOOLEAN,function(e,t){return new v(e.value===t.real&&!t.imaginary)}),we._define("=",Ee.INTEGER,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value===t.value)}),we._define("=",Ee.INTEGER,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value===t.value)}),we._define("=",Ee.INTEGER,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value===t.value)}),we._define("=",Ee.NATURAL,Ee.COMPLEX,Ee.BOOLEAN,function(e,t){return new v(e.value===t.real&&!t.imaginary)}),we._define("=",Ee.NATURAL,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value===t.value)}),we._define("=",Ee.NATURAL,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value===t.value)}),we._define("=",Ee.NATURAL,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value===t.value)}),we._define("=",Ee.BOOLEAN,Ee.BOOLEAN,Ee.BOOLEAN,function(e,t){return new v(e.value===t.value)}),we._define("=",Ee.STRING,Ee.STRING,Ee.BOOLEAN,function(e,t){return new v(e.value===t.value)}),we._define("=",Ee.LIST,Ee.LIST,Ee.BOOLEAN,function(e,t){var n=e.getLength();if(n!==t.getLength())return v.FALSE;for(var r=0;r<e.length;r++){var i=we.select("=",e.lookup(r).character,t.lookup(r).character);if(!i.handler(e.lookup(r),t.lookup(r)).value)return v.FALSE}return v.TRUE}),we._define("!=",Ee.COMPLEX,Ee.COMPLEX,Ee.BOOLEAN,function(e,t){return new v(e.real!==t.real||e.imaginary!==t.imaginary)}),we._define("!=",Ee.COMPLEX,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.real!==t.value||!!e.imaginary)}),we._define("!=",Ee.COMPLEX,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.real!==t.value||!!e.imaginary)}),we._define("!=",Ee.COMPLEX,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.real!==t.value||!!e.imaginary)}),we._define("!=",Ee.REAL,Ee.COMPLEX,Ee.BOOLEAN,function(e,t){return new v(e.value!==t.real||!!t.imaginary)}),we._define("!=",Ee.REAL,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value!==t.value)}),we._define("!=",Ee.REAL,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value!==t.value)}),we._define("!=",Ee.REAL,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value!==t.value)}),we._define("!=",Ee.INTEGER,Ee.COMPLEX,Ee.BOOLEAN,function(e,t){return new v(e.value!==t.real||!!t.imaginary)}),we._define("!=",Ee.INTEGER,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value!==t.value)}),we._define("!=",Ee.INTEGER,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value!==t.value)}),we._define("!=",Ee.INTEGER,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value!==t.value)}),we._define("!=",Ee.NATURAL,Ee.COMPLEX,Ee.BOOLEAN,function(e,t){return new v(e.value!==t.real||!!t.imaginary)}),we._define("!=",Ee.NATURAL,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value!==t.value)}),we._define("!=",Ee.NATURAL,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value!==t.value)}),we._define("!=",Ee.NATURAL,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value!==t.value)}),we._define("!=",Ee.BOOLEAN,Ee.BOOLEAN,Ee.BOOLEAN,function(e,t){return new v(e.value!==t.value)}),we._define("!=",Ee.STRING,Ee.STRING,Ee.BOOLEAN,function(e,t){return new v(e.value!==t.value)}),we._define("!=",Ee.LIST,Ee.LIST,Ee.BOOLEAN,function(e,t){var n=e.getLength();if(n!==t.getLength())return v.TRUE;for(var r=0;r<n;r++){var i=we.select("!=",e.lookup(r).character,t.lookup(r).character);if(i.handler(e.lookup(r),t.lookup(r)).value)return v.TRUE}return v.FALSE}),we._define("<",Ee.REAL,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value<t.value)}),we._define("<",Ee.REAL,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value<t.value)}),we._define("<",Ee.REAL,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value<t.value)}),we._define("<",Ee.INTEGER,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value<t.value)}),we._define("<",Ee.INTEGER,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value<t.value)}),we._define("<",Ee.INTEGER,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value<t.value)}),we._define("<",Ee.NATURAL,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value<t.value)}),we._define("<",Ee.NATURAL,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value<t.value)}),we._define("<",Ee.NATURAL,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value<t.value)}),we._define("<",Ee.BOOLEAN,Ee.BOOLEAN,Ee.BOOLEAN,function(e,t){return new v(e.value<t.value)}),we._define("<",Ee.STRING,Ee.STRING,Ee.BOOLEAN,function(e,t){return new v(e.value<t.value)}),we._define(">",Ee.REAL,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value>t.value)}),we._define(">",Ee.REAL,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value>t.value)}),we._define(">",Ee.REAL,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value>t.value)}),we._define(">",Ee.INTEGER,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value>t.value)}),we._define(">",Ee.INTEGER,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value>t.value)}),we._define(">",Ee.INTEGER,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value>t.value)}),we._define(">",Ee.NATURAL,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value>t.value)}),we._define(">",Ee.NATURAL,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value>t.value)}),we._define(">",Ee.NATURAL,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value>t.value)}),we._define(">",Ee.BOOLEAN,Ee.BOOLEAN,Ee.BOOLEAN,function(e,t){return new v(e.value>t.value)}),we._define(">",Ee.STRING,Ee.STRING,Ee.BOOLEAN,function(e,t){return new v(e.value>t.value)}),we._define("<=",Ee.REAL,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value<=t.value)}),we._define("<=",Ee.REAL,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value<=t.value)}),we._define("<=",Ee.REAL,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value<=t.value)}),we._define("<=",Ee.INTEGER,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value<=t.value)}),we._define("<=",Ee.INTEGER,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value<=t.value)}),we._define("<=",Ee.INTEGER,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value<=t.value)}),we._define("<=",Ee.NATURAL,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value<=t.value)}),we._define("<=",Ee.NATURAL,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value<=t.value)}),we._define("<=",Ee.NATURAL,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value<=t.value)}),we._define("<=",Ee.BOOLEAN,Ee.BOOLEAN,Ee.BOOLEAN,function(e,t){return new v(e.value<=t.value)}),we._define("<=",Ee.STRING,Ee.STRING,Ee.BOOLEAN,function(e,t){return new v(e.value<=t.value)}),we._define(">=",Ee.REAL,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value>=t.value)}),we._define(">=",Ee.REAL,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value>=t.value)}),we._define(">=",Ee.REAL,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value>=t.value)}),we._define(">=",Ee.INTEGER,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value>=t.value)}),we._define(">=",Ee.INTEGER,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value>=t.value)}),we._define(">=",Ee.INTEGER,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value>=t.value)}),we._define(">=",Ee.NATURAL,Ee.REAL,Ee.BOOLEAN,function(e,t){return new v(e.value>=t.value)}),we._define(">=",Ee.NATURAL,Ee.INTEGER,Ee.BOOLEAN,function(e,t){return new v(e.value>=t.value)}),we._define(">=",Ee.NATURAL,Ee.NATURAL,Ee.BOOLEAN,function(e,t){return new v(e.value>=t.value)}),we._define(">=",Ee.BOOLEAN,Ee.BOOLEAN,Ee.BOOLEAN,function(e,t){return new v(e.value>=t.value)}),we._define(">=",Ee.STRING,Ee.STRING,Ee.BOOLEAN,function(e,t){return new v(e.value>=t.value)}),we._define("and",Ee.BOOLEAN,Ee.BOOLEAN,Ee.BOOLEAN,function(e,t){return new v(e.value&&t.value)}),we._define("or",Ee.BOOLEAN,Ee.BOOLEAN,Ee.BOOLEAN,function(e,t){return new v(e.value||t.value)}),we._define("xor",Ee.BOOLEAN,Ee.BOOLEAN,Ee.BOOLEAN,function(e,t){return new v(e.value!=t.value)});var Le={};e.DefaultContext=Le,Le.TYPES=l.EMPTY.addAll({typeof:new X(new b("T"),B.DEFAULT),not:new X(G.DEFAULT,G.DEFAULT),and:new X(G.DEFAULT,new X(G.DEFAULT,G.DEFAULT)),or:new X(G.DEFAULT,new X(G.DEFAULT,G.DEFAULT)),xor:new X(G.DEFAULT,new X(G.DEFAULT,G.DEFAULT)),seq:new X(_.DEFAULT,I.DEFAULT),range:new X(k.DEFAULT,new M(k.DEFAULT)),new:new X(new X(_.DEFAULT,new b("T")),new b("T")),JavaScript:_.DEFAULT.extend("UNDEFINED",V.DEFAULT).extend("NULL",q.DEFAULT)}),Le.VALUES=l.EMPTY.addAll({typeof:m.fromFunction(function(e){return new d(f(e.character))}),"+":we.make("+"),"-":we.make("-"),"|":we.make("|"),"^":we.make("^"),"*":we.make("*"),"/":we.make("/"),"%":we.make("%"),"&":we.make("&"),"**":we.make("**"),"=":we.make("="),"!=":we.make("!="),"<":we.make("<"),">":we.make(">"),"<=":we.make("<="),">=":we.make(">="),not:m.fromFunction(function(e){if(e.is(v))return new v((!e.value));throw new u}),and:we.make("and"),or:we.make("or"),xor:we.make("xor"),seq:new H(ee.INSTANCE,new K("f",null,new K("x",null,new W("f")))).evaluate(l.EMPTY),range:m.fromFunction(function(e){if(e.is(y)){for(var t=[],n=0;n<e;n++)t.push(new y(n));return new N(t)}throw new u}),new:m.fromFunction(function(e){if(e.is(m))return e.bind(h.DEFAULT);throw new u("argument of 'new' must be a closure")}),JavaScript:h.DEFAULT.extend("UNDEFINED",O.DEFAULT).extend("NULL",g.DEFAULT)});var Ae={};e.NodeJSContext=Ae,Ae.TYPES=Le.TYPES.addAll({module:I.DEFAULT,require:new X(B.DEFAULT,I.DEFAULT)}),Ae.VALUES=Le.VALUES.addAll({module:p.unmarshal(module),require:m.fromFunction(function(e){if(e.is(d))return p.unmarshal(require(e.value));throw new u("argument of 'require' must be a string")})}),e.Lexer=pe,e.Parser=he,he.prototype.parseInteger=function(){return new J(new y(this.lexer.expect("integer")),k.DEFAULT)},he.prototype.parseComplex=function(){return new J(new w(0,this.lexer.expect("complex")),C.DEFAULT)},he.prototype.parseReal=function(){return new J(new L(this.lexer.expect("real")),D.DEFAULT)},he.prototype.parseString=function(){return new J(new d(this.lexer.expect("string")),B.DEFAULT)},he.prototype.parseVariable=function(){var e=this.lexer.label();return this.lexer.next(),new W(e)},he.prototype.parseClass0=function(){switch(this.lexer.token()){case"keyword:undefined":return this.lexer.next(),new J(h.DEFAULT,_.DEFAULT);case"keyword:true":return this.lexer.next(),new J(v.TRUE,G.DEFAULT);case"keyword:false":return this.lexer.next(),new J(v.FALSE,G.DEFAULT);case"integer":return this.parseInteger();case"complex":return this.parseComplex();case"real":return this.parseReal();case"string":return this.parseString();case"identifier":case"keyword:typeof":return this.parseVariable();case"keyword:fix":return this.lexer.next(),ee.INSTANCE;case"keyword:error":return this.lexer.next(),$.INSTANCE;case"left":this.lexer.next();var e=this.parseRoot(["right"]);return this.lexer.next(),e;case"left-curly":this.lexer.next();for(var t=[];"right-curly"!==this.lexer.token();)t.push(this.parseRoot(["comma","right-curly"])),"comma"===this.lexer.token()&&this.lexer.next();return this.lexer.next(),new Y(t);default:return this.lexer.throwSyntaxError()}},he.prototype.parseSubscriptOrFieldAccess=function(e){for(;;)switch(this.lexer.token()){case"point":var t=this.lexer.next();if("identifier"!==t&&!t.match(/^keyword\:/))return this.lexer.throwSyntaxError("identifier");e=new Z(e,this.lexer.expect(t));break;case"left-square":this.lexer.next();var n=this.parseRoot(["right-square"]);this.lexer.next(),e=new z(e,n);break;default:return e}},he.prototype.parseClass1=function(){return this.parseSubscriptOrFieldAccess(this.parseClass0())},he.prototype.parseTypeClass0=function(){var e=this.lexer.token();switch(this.lexer.next(),e){case"keyword:undefined":return _.DEFAULT;case"keyword:boolean":return G.DEFAULT;case"keyword:complex":return C.DEFAULT;case"keyword:real":return D.DEFAULT;case"keyword:integer":return S.DEFAULT;case"keyword:natural":return k.DEFAULT;case"keyword:string":return B.DEFAULT;case"keyword:unknown":return I.DEFAULT;case"left":var t=this.parseTypeClass2();return this.lexer.expect("right"),t;default:return this.lexer.throwSyntaxError()}},he.prototype.parseTypeClass1=function(){for(var e=this.parseTypeClass0();;){var t=this.lexer.token();if("asterisk"===t)e=new M(e);else{if("power"!==t)return e;e=new M(new M(e))}this.lexer.next()}},he.prototype.parseTypeClass2=function(){var e=this.parseTypeClass1();return"fat-arrow"!==this.lexer.token()?e:(this.lexer.next(),new X(e,this.parseTypeClass2()))},he.prototype.parseType=function(){return this.parseTypeClass2()},he.prototype.parseLambdaPartial=function(e){var t=this.lexer.expect("identifier"),n=function(){return"colon"!==this.lexer.token()?null:(this.lexer.next(),this.parseType(["comma","arrow"]))}.call(this);switch(this.lexer.token()){case"comma":return this.lexer.next(),new K(t,n,this.parseLambdaPartial(e));case"arrow":return this.lexer.next(),new K(t,n,this.parseRoot(e));default:return this.lexer.throwSyntaxError("comma","arrow")}},he.prototype.parseLambda=function(e){return this.lexer.expect("keyword:fn"),this.parseLambdaPartial(e)},he.prototype.parseLetPartial=function(e){for(var t=[this.lexer.expect("identifier")];"point"===this.lexer.token();){var n=this.lexer.next();if("identifier"!==n&&!n.match(/^keyword\:/))return this.lexer.throwSyntaxError("identifier");t.push(this.lexer.expect(n))}this.lexer.expect("equal");var r=this.parseRoot(["comma","keyword:in"]);switch(this.lexer.token()){case"comma":return this.lexer.next(),new Q(t,r,this.parseLetPartial(e));case"keyword:in":return this.lexer.next(),new Q(t,r,this.parseRoot(e));default:return this.lexer.throwSyntaxError("comma","keyword:in")}},he.prototype.parseLet=function(e){return this.lexer.expect("keyword:let"),this.parseLetPartial(e)},he.prototype.parseIf=function(e){this.lexer.expect("keyword:if");var t=this.parseRoot(["keyword:then"]);this.lexer.next();var n=this.parseRoot(["keyword:else"]);return this.lexer.next(),new te(t,n,this.parseRoot(e))},he.prototype.parseThrow=function(e){return this.lexer.expect("keyword:throw"),new ne(this.parseRoot(e))},he.prototype.parseTry=function(e){this.lexer.expect("keyword:try");var t=this.parseRoot(["keyword:catch","keyword:finally"]);switch(this.lexer.token()){case"keyword:catch":this.lexer.next();var n=this.parseRoot(e.union("keyword:finally"));return"keyword:finally"===this.lexer.token()?(this.lexer.next(),new oe(t,n,this.parseRoot(e))):e.contains(this.lexer.token())?new re(t,n):this.lexer.throwSyntaxError();case"keyword:finally":return this.lexer.next(),new ie(t,this.parseRoot(e));default:return this.lexer.throwSyntaxError("keyword:catch","keyword:finally")}},he.prototype.parseClass2=function(e){switch(this.lexer.token()){case"keyword:fn":return this.parseLambda(e);case"keyword:let":return this.parseLet(e);case"keyword:if":return this.parseIf(e);case"keyword:throw":return this.parseThrow(e);case"keyword:try":return this.parseTry(e);default:return this.parseClass1(e)}},he.prototype.parseClass3=function(e){for(var t=this.parseClass2(e);!e.contains(this.lexer.token());)t=new H(t,this.parseClass2(e));return t},he.prototype.parseInfixPower=function(e){var t=this.parseClass3(e.union("power"));if("power"!==this.lexer.token())return t;var n=new H(new W("**"),t);return e.contains(this.lexer.next())?n:new H(n,this.parseClass4(e))},he.prototype.parsePrefixPower=function(e){if(e.contains(this.lexer.next()))return new W("**");var t=this.parseClass3(e.union("power"));if(e.contains(this.lexer.token())){var n=new H(new W("**"),new W("0"));return new K("0",null,new H(n,t))}return this.lexer.throwSyntaxError()},he.prototype.parseClass4=function(e){return"power"!==this.lexer.token()?this.parseInfixPower(e.difference("power")):this.parsePrefixPower(e.difference("power"))},he.prototype.parseInfixProduct=function(e){for(var t=this.parseClass4(e.union("asterisk","product"));!e.contains(this.lexer.token());){var n=new H(new W(this.lexer.expect("asterisk","product")),t);if(e.contains(this.lexer.token()))return n;t=new H(n,this.parseClass4(e.union("asterisk","product")))}return t},he.prototype.parsePrefixProduct=function(e){var t=this.lexer.label();if(e.contains(this.lexer.next()))return new W(t);var n=this.parseClass4(e.union("asterisk","product"));if(e.contains(this.lexer.token())){var r=new H(new W(t),new W("0"));return new K("0",null,new H(r,n))}return this.lexer.throwSyntaxError()},he.prototype.parseClass5=function(e){switch(this.lexer.token()){case"asterisk":case"product":return this.parsePrefixProduct(e.difference("asterisk","product"));default:return this.parseInfixProduct(e.difference("asterisk","product"))}},he.prototype.parseInfixSum=function(e){for(var t=this.parseClass5(e.union("sum"));!e.contains(this.lexer.token());){var n=new H(new W(this.lexer.expect("sum")),t);if(e.contains(this.lexer.token()))return n;t=new H(n,this.parseClass5(e.union("sum")))}return t},he.prototype.parsePrefixSum=function(e){var t=this.lexer.label();if(e.contains(this.lexer.next()))return new W(t);var n=this.parseClass5(e.union("sum"));if(e.contains(this.lexer.token())){var r=new H(new W(t),new W("0"));return new K("0",null,new H(r,n))}return this.lexer.throwSyntaxError()},he.prototype.parseClass6=function(e){return"sum"!==this.lexer.token()?this.parseInfixSum(e.difference("sum")):this.parsePrefixSum(e.difference("sum"))},he.prototype.parseInfixComparison=function(e){var t=this.parseClass6(e.union("equal","comparison"));if(e.contains(this.lexer.token()))return t;for(var n=[t],r=[];!e.contains(this.lexer.token());)r.push(new W(this.lexer.expect("equal","comparison"))),n.push(this.parseClass6(e.union("equal","comparison")));return new ae(n,r)},he.prototype.parsePrefixComparison=function(e){var t=this.lexer.label();if(e.contains(this.lexer.next()))return new W(t);var n=this.parseClass6(e.union("equal","comparison"));if(e.contains(this.lexer.token())){var r=new H(new W(t),new W("0"));return new K("0",null,new H(r,n))}return this.lexer.throwSyntaxError()},he.prototype.parseClass7=function(e){switch(this.lexer.token()){case"equal":case"comparison":return this.parsePrefixComparison(e.difference("equal","comparison"));
default:return this.parseInfixComparison(e.difference("equal","comparison"))}},he.prototype.parseClass8=function(e){if("keyword:not"!==this.lexer.token())return this.parseClass7(e);var t=new W("not");return e.contains(this.lexer.next())?t:new H(t,this.parseClass8(e))},he.prototype.parseInfixAnd=function(e){for(var t=this.parseClass8(e.union("keyword:and"));!e.contains(this.lexer.token());){var n=new H(new W(this.lexer.expect("keyword:and")),t);if(e.contains(this.lexer.token()))return n;t=new H(n,this.parseClass8(e.union("keyword:and")))}return t},he.prototype.parsePrefixAnd=function(e){var t=this.lexer.label();if(e.contains(this.lexer.next()))return new W(t);var n=this.parseClass8(e.union("keyword:and"));if(e.contains(this.lexer.token())){var r=new H(new W(t),new W("0"));return new K("0",null,new H(r,n))}return this.lexer.throwSyntaxError()},he.prototype.parseClass9=function(e){return"keyword:and"!==this.lexer.token()?this.parseInfixAnd(e.difference("keyword:and")):this.parsePrefixAnd(e.difference("keyword:and"))},he.prototype.parseInfixOr=function(e){for(var t=this.parseClass9(e.union("keyword:or","keyword:xor"));!e.contains(this.lexer.token());){var n=new H(new W(this.lexer.expect("keyword:or","keyword:xor")),t);if(e.contains(this.lexer.token()))return n;t=new H(n,this.parseClass9(e.union("keyword:or","keyword:xor")))}return t},he.prototype.parsePrefixOr=function(e){var t=this.lexer.label();if(e.contains(this.lexer.next()))return new W(t);var n=this.parseClass9(e.union("keyword:or","keyword:xor"));if(e.contains(this.lexer.token())){var r=new H(new W(t),new W("0"));return new K("0",null,new H(r,n))}return this.lexer.throwSyntaxError()},he.prototype.parseClass10=function(e){switch(this.lexer.token()){case"keyword:or":case"keyword:xor":return this.parsePrefixOr(e.difference("keyword:or","keyword:xor"));default:return this.parseInfixOr(e.difference("keyword:or","keyword:xor"))}},he.prototype.parseRoot=function(e){return this.parseClass10(e)},he.prototype.parse=function(){return this.parseRoot(["end"])},e.parse=function(e){return new he(e).parse()}}(module.exports);